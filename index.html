<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome Translator API Comprehensive Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3ff6;
        }
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            cursor: pointer;
            list-style: none; /* Hide default marker */
        }
        details > summary {
            list-style: none; /* Hide default marker */
        }
        details > summary::-webkit-details-marker {
            display: none; /* Hide marker on Webkit */
        }
        /* Custom chevron icon */
        details[open] .chevron {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">
            Chrome Translator API Language Checker
        </h1>
        <p class="text-center text-sm text-gray-500 mb-6">
            Testing all unique language roots for availability in three different translation directions.
        </p>

        <div id="status" class="mb-6 p-4 rounded-lg text-center bg-yellow-100 text-yellow-800 border border-yellow-300 font-medium">
            Checking for Translator API availability...
        </div>

        <div class="space-y-2" id="results-container">
            <!-- Results will be injected here -->
        </div>

        <div id="progress" class="mt-8 text-center text-gray-600">
            <p id="progress-text" class="text-sm font-medium"></p>
        </div>
    </div>

    <script>
        // --- Language List Preparation ---

        // The full list provided by the user
        const fullLanguageList = `
            af-ZA Afrikaans South Africa, am-ET Amharic Ethiopia, ar-SA Arabic Saudi Arabia,
            az-AZ Azerbaijani Azerbaijan, be-BY Belarusian Belarus, bg-BG Bulgarian Bulgaria,
            bn-IN Bengali India, bs-BA Bosnian Bosnia and Herzegovina, ca-ES Catalan Spain,
            cs-CZ Czech Czech Republic, cy-GB Welsh United Kingdom, da-DK Danish Denmark,
            de-AT German Austria, de-CH German Switzerland, de-DE German Germany,
            el-GR Greek Greece, en-AU English Australia, en-CA English Canada,
            en-GB English United Kingdom, en-IE English Ireland, en-IN English India,
            en-NZ English New Zealand, en-US English United States, en-ZA English South Africa,
            es-AR Spanish Argentina, es-CL Spanish Chile, es-CO Spanish Colombia,
            es-ES Spanish Spain, es-MX Spanish Mexico, es-PE Spanish Peru,
            et-EE Estonian Estonia, fa-IR Persian Iran, fi-FI Finnish Finland,
            fil-PH Filipino Philippines, fr-BE French Belgium, fr-CA French Canada,
            fr-CH French Switzerland, fr-FR French France, ga-IE Irish Ireland,
            gl-ES Galician Spain, gu-IN Gujarati India, he-IL Hebrew Israel,
            hi-IN Hindi India, hr-HR Croatian Croatia, hu-HU Hungarian Hungary,
            id-ID Indonesian Indonesia, is-IS Icelandic Iceland, it-CH Italian Switzerland,
            it-IT Italian Italy, ja-JP Japanese Japan, jv-ID Javanese Indonesia,
            km-KH Khmer Cambodia, kn-IN Kannada India, ko-KR Korean South Korea,
            lo-LA Lao Laos, lt-LT Lithuanian Lithuania, lv-LV Latvian Latvia,
            ml-IN Malayalam India, mr-IN Marathi India, ms-MY Malay Malaysia,
            nb-NO Norwegian Bokmål Norway, ne-NP Nepali Nepal, nl-BE Dutch Belgium,
            nl-NL Dutch Netherlands, no-NO Norwegian Norway, pa-IN Punjabi India,
            pl-PL Polish Poland, pt-BR Portuguese Brazil, pt-PT Portuguese Portugal,
            ro-RO Romanian Romania, ru-RU Russian Russia, si-LK Sinhala Sri Lanka,
            sk-SK Slovak Slovakia, sl-SI Slovenian Slovenia, sq-AL Albanian Albania,
            sr-RS Serbian Serbia, sv-FI Swedish Finland, sv-SE Swedish Sweden,
            sw-KE Swahili Kenya, ta-IN Tamil India, te-IN Telugu India,
            th-TH Thai Thailand, tr-TR Turkish Turkey, uk-UA Ukrainian Ukraine,
            ur-PK Urdu Pakistan, vi-VN Vietnamese Vietnam, zh-CN Chinese China,
            zh-HK Chinese Hong Kong, zh-SG Chinese Singapore, zh-TW Chinese Taiwan,
            zu-ZA Zulu South Africa
        `;

        // Map for easy lookup: 'en' -> 'English'
        const languageMap = new Map();
        
        // Set to store unique root codes: 'en', 'es', etc.
        const uniqueRootCodes = new Set();

        fullLanguageList.trim().split(',').forEach(line => {
            const parts = line.trim().split(/\s+/);
            if (parts.length >= 2) {
                const code = parts[0]; // e.g., 'en-US'
                const rootCode = code.split('-')[0]; // e.g., 'en'
                // Reconstruct the language name without the region/country details
                const name = parts.slice(1).join(' ').replace(/\s+([A-Z]{2}|\d{3})$/g, '').trim(); 

                // Map root code to its full, human-readable name (using the first entry found)
                if (!languageMap.has(rootCode)) {
                    // Normalize the name, removing country names which were appended after the language name
                    languageMap.set(rootCode, name.replace(/(\s[A-Z][a-z]+)+$/g, '').trim());
                }
                
                uniqueRootCodes.add(rootCode);
            }
        });

        // Convert Set to Array for iteration
        const languagesToCheck = Array.from(uniqueRootCodes);
        const totalLanguages = languagesToCheck.length;
        const totalChecks = totalLanguages * 3; // L->EN, EN->L, L->L

        // --- DOM Elements ---
        const statusElement = document.getElementById('status');
        const resultsContainer = document.getElementById('results-container');
        const progressTextElement = document.getElementById('progress-text');

        // --- Utility Functions ---

        function getStatusClasses(status) {
            switch (status) {
                case 'available':
                    return 'text-green-600 bg-green-50';
                case 'downloadable':
                    return 'text-blue-600 bg-blue-50';
                case 'downloading':
                    return 'text-yellow-600 bg-yellow-50';
                case 'unavailable':
                    return 'text-red-600 bg-red-50';
                case 'error':
                    return 'text-gray-600 bg-gray-100';
                default:
                    return 'text-gray-500 bg-gray-50';
            }
        }

        function createResultDetail(source, target, status, message) {
            const statusClasses = getStatusClasses(status);
            return `
                <div class="flex justify-between items-center py-2 px-3 my-1 rounded-md text-sm ${statusClasses}">
                    <span class="font-medium">
                        ${source.toUpperCase()} &rarr; ${target.toUpperCase()}
                    </span>
                    <span class="capitalize font-semibold">
                        ${status}
                    </span>
                    ${message ? `<p class="text-xs text-opacity-80 hidden sm:block">${message}</p>` : ''}
                </div>
            `;
        }
        
        function createLanguageCard(rootCode, languageName, resultsHtml) {
            const isEnglish = rootCode === 'en';
            // Determine the 'worst' status for the summary icon (Unavailable > Downloadable > Available)
            let overallStatus = 'available';
            if (resultsHtml.includes('unavailable')) overallStatus = 'unavailable';
            else if (resultsHtml.includes('downloadable')) overallStatus = 'downloadable';

            const summaryClasses = overallStatus === 'unavailable' ? 'bg-red-50 border-red-200' : 'bg-white border-gray-200';
            const iconColor = overallStatus === 'unavailable' ? 'text-red-600' : 'text-indigo-600';

            const card = document.createElement('details');
            card.className = `border border-gray-200 rounded-xl shadow-md overflow-hidden ${summaryClasses}`;
            card.innerHTML = `
                <summary class="summary-header p-4 bg-white hover:bg-gray-50 transition-colors duration-150 rounded-xl ${isEnglish ? 'ring-2 ring-indigo-500' : ''}">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 chevron transition-transform duration-200 ${iconColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        <span class="text-lg font-bold text-gray-800">${languageName} (${rootCode.toUpperCase()})</span>
                    </div>
                    ${isEnglish ? '<span class="text-xs text-indigo-500 font-semibold border border-indigo-300 px-2 py-0.5 rounded-full">Base Language</span>' : ''}
                </summary>
                <div class="p-4 pt-0 space-y-2 border-t border-gray-100">
                    ${resultsHtml}
                </div>
            `;
            resultsContainer.appendChild(card);
        }

        // --- Main Logic ---

        async function checkTranslatorAvailability() {
            // Check if the Translator API object exists in the global scope (window.ai.translator)
            if (!('ai' in window) || !('translator' in window.ai)) {
                statusElement.className = 'mb-6 p-4 rounded-lg text-center bg-red-100 text-red-800 border border-red-300 font-medium';
                statusElement.textContent = '❌ Translator API Not Found. This feature requires Chrome 138+ with the built-in AI flags enabled. Cannot proceed.';
                progressTextElement.textContent = '';
                return;
            }

            statusElement.className = 'mb-6 p-4 rounded-lg text-center bg-blue-100 text-blue-800 border border-blue-300 font-medium';
            statusElement.textContent = `✅ Translator API Found. Preparing ${totalLanguages} unique language roots for ${totalChecks} checks...`;

            let currentCheck = 0;

            for (const L of languagesToCheck) {
                const languageName = languageMap.get(L) || 'Unknown Language';
                let resultsHtml = '';

                // --- 1. L -> EN Check ---
                currentCheck++;
                progressTextElement.textContent = `(${currentCheck} of ${totalChecks}) Checking: ${languageName} (${L.toUpperCase()} \u2192 EN)...`;
                
                try {
                    // Exponential backoff retry logic (basic implementation)
                    const status_L_to_EN = await retryAvailabilityCheck({ sourceLanguage: L, targetLanguage: 'en' });
                    resultsHtml += createResultDetail(L, 'en', status_L_to_EN);
                } catch (error) {
                    console.error(`Error checking ${L} -> en:`, error);
                    resultsHtml += createResultDetail(L, 'en', 'error', `Check Failed: ${error.message}`);
                }

                // --- 2. EN -> L Check ---
                currentCheck++;
                progressTextElement.textContent = `(${currentCheck} of ${totalChecks}) Checking: ${languageName} (EN \u2192 ${L.toUpperCase()})...`;

                try {
                    const status_EN_to_L = await retryAvailabilityCheck({ sourceLanguage: 'en', targetLanguage: L });
                    resultsHtml += createResultDetail('en', L, status_EN_to_L);
                } catch (error) {
                    console.error(`Error checking en -> ${L}:`, error);
                    resultsHtml += createResultDetail('en', L, 'error', `Check Failed: ${error.message}`);
                }
                
                // --- 3. L -> L Check ---
                currentCheck++;
                progressTextElement.textContent = `(${currentCheck} of ${totalChecks}) Checking: ${languageName} (${L.toUpperCase()} \u2192 ${L.toUpperCase()})...`;

                try {
                    const status_L_to_L = await retryAvailabilityCheck({ sourceLanguage: L, targetLanguage: L });
                    resultsHtml += createResultDetail(L, L, status_L_to_L);
                } catch (error) {
                    console.error(`Error checking ${L} -> ${L}:`, error);
                    resultsHtml += createResultDetail(L, L, 'error', `Check Failed: ${error.message}`);
                }
                
                createLanguageCard(L, languageName, resultsHtml);
            }

            // Final status update
            statusElement.className = 'mb-6 p-4 rounded-lg text-center bg-green-100 text-green-800 border border-green-300 font-medium';
            statusElement.textContent = `✅ Testing Complete! Performed ${totalChecks} availability checks across ${totalLanguages} unique language roots.`;
            progressTextElement.textContent = 'Expand each language below to see the results of all three tests.';
        }

        // Simple utility to sleep for a duration
        const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // Function with basic exponential backoff retry logic for the API call
        async function retryAvailabilityCheck(options, maxRetries = 3) {
            let delay = 1000; // 1 second
            let lastError = null;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const availability = await window.ai.translator.availability(options);
                    return availability;
                } catch (error) {
                    lastError = error;
                    // Log the attempt silently (no console logging requested in instructions)
                    if (i < maxRetries - 1) {
                        await sleep(delay);
                        delay *= 2; // Double the delay for the next attempt
                    }
                }
            }
            // If all retries fail, throw the last error
            throw lastError;
        }


        // Start the check when the window loads
        window.onload = checkTranslatorAvailability;

    </script>
</body>
</html>
